name: flexemu-clang-tidy-check
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  clang-tidy-check:
    strategy:
      matrix:
        os: [ ubuntu-latest ]
        qt-version: [ 5 ]
    runs-on: ${{ matrix.os }}
    defaults:
      run:
        # Use bash login shell sourcing ~/.bash_profile
        shell: bash -leo pipefail {0}
    steps:

      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: 'true'

      - name: Install packages
        run: |
          sudo apt-get update
          sudo apt-get install build-essential qtbase5-dev qtbase5-dev-tools libqt5x11extras5-dev clang-tidy
          echo "clang-tidy version:" `clang-tidy --version`

      - name: Configure
        run: ./configure --prefix=$HOME/usr --sysconfdir=$HOME/etc || cat config.log

      - name: Clang-tidy check
        run: make clang-tidy-check

